<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref=""></ion-back-button>
    </ion-buttons>
    <ion-title>
      <span [ngClass]="'flag-icon flag-icon-' + countryStatus?.country?.code?.toLowerCase()"></span>
      {{ countryStatus?.country?.name }}
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>

  <ion-grid>

    <ion-row>

      <ion-col size-lg="6" size-md="6" size-sm="12" size-xs="12">
        <ion-row>
          <ion-col size="12">
            <ion-card mode="ios">
              <ion-card-header>
                <!-- <ion-card-subtitle>Updated {{ countryStatus?.updatedAt | dateAgo }}</ion-card-subtitle> -->
                <ion-card-title class="ion-margin-bottom">Report in <br>tempo reale</ion-card-title>
                <span [ngClass]="'flag-icon flag-icon-' + countryStatus?.country?.code?.toLowerCase()"></span>
                <ion-segment (ionChange)="changeReport($event)" [value]="showTodayReport" mode="ios">
                  <ion-segment-button value="full">
                    <ion-label>Generale</ion-label>
                  </ion-segment-button>
                  <ion-segment-button value="today">
                    <ion-label>Oggi</ion-label>
                  </ion-segment-button>
                </ion-segment>
              </ion-card-header>
              <ion-card-content>
                <ion-list>
                  <ion-item class="ion-no-padding" lines="full">
                    <ion-icon name="medkit-outline" slot="start"></ion-icon>
                    <ion-label>
                      <h2>Infetti</h2>
                    </ion-label>
                    <ion-label slot="end" class="ion-text-right country-cases">
                      <h2 class="text-bold" *ngIf="showTodayReport == 'full'">{{ countryStatus?.confirmed | number }}</h2>
                      <h2 class="text-bold" *ngIf="showTodayReport == 'today'"><span class="percentage">+ </span>{{ countryStatus?.todayInfected | number }}</h2>
                    </ion-label>
                  </ion-item>
                  <ion-item class="ion-no-padding" lines="full">
                    <ion-icon name="bed-outline" slot="start"></ion-icon>
                    <ion-label>
                      <h2>Deaths</h2>
                    </ion-label>
                    <ion-label slot="end" class="ion-text-right country-cases">
                      <h2 class="text-bold" *ngIf="showTodayReport == 'full'">{{ countryStatus?.deaths | number }}</h2>
                      <h2 class="text-bold" *ngIf="showTodayReport == 'today'"><span class="percentage">+ </span>{{ countryStatus?.todayDeaths | number }}</h2>
                    </ion-label>
                  </ion-item>
                  <ion-item class="ion-no-padding" lines="full">
                    <ion-icon name="shield-checkmark-outline" slot="start"></ion-icon>
                    <ion-label>
                      <h2>Recovered</h2>
                    </ion-label>
                    <ion-label slot="end" class="ion-text-right country-cases">
                      <h2 class="text-bold" *ngIf="showTodayReport == 'full'">{{ countryStatus?.recovered | number }}</h2>
                      <h2 class="text-bold" *ngIf="showTodayReport == 'today'"><span class="percentage">+ </span>{{ countryStatus?.todayRecovered | number }}</h2>
                    </ion-label>
                  </ion-item>
                </ion-list>
              </ion-card-content>
            </ion-card>
          </ion-col>
          <ion-col size="12">
            <ion-card mode="ios">
              <ion-card-header>
                <ion-card-title>
                  Situazione
                </ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <ion-list>
                  <ion-item class="ion-no-padding" lines="full">
                    <ion-icon name="pulse-outline" slot="start"></ion-icon>
                    <ion-label>
                      <h2 class="text-semibold">Casi attivi</h2>
                    </ion-label>
                    <ion-label slot="end" class="ion-text-right country-cases">
                      <h2 class="text-bold">{{ countryStatus?.active | number }}</h2>
                    </ion-label>
                  </ion-item>
                  <!-- <ion-item class="ion-no-padding" lines="full">
                    <ion-icon name="pulse-outline" slot="start"></ion-icon>
                    <ion-label>
                      <h2 class="text-semibold">Casi critici</h2>
                    </ion-label>
                    <ion-label slot="end" class="ion-text-right country-cases">
                      <h2 class="text-bold">{{ countryStatus?.critical | number }}</h2>
                    </ion-label>
                  </ion-item> -->
                </ion-list>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>
      </ion-col>

      <ion-col size-lg="6" size-md="6" size-sm="12" size-xs="12">
        <ion-row>
          <ion-col size="12">
            <ion-card mode="ios">
              <ion-card-header>
                <ion-card-subtitle>
                  Popolazione: 
                  <span class="text-bold">{{ countryStatus?.country?.population | number }}</span>
                </ion-card-subtitle>
                <ion-card-title class="population-title">
                  {{ countryStatus?.stats?.casesPerMillionPopulation | number }}
                  <span class="percentage">casi</span>
                  <p class="percentage">ogni 1M abitanti</p>
                </ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <ion-label>
                  <p class="ion-text-wrap"><span class="text-bold">{{ countryStatus?.confirmed | number }}</span> infetti</p>
                  <p class="ion-text-wrap"><span class="text-bold">{{ populationInfectedRatio }}%</span> della popolazione infetta</p>
                </ion-label>
              </ion-card-content>
              <circle-progress 
                  [percent]="populationInfectedRatio" 
                  [radius]="50"
                  [title]="populationInfectedRatio"
                  [titleFontSize]="14"
                  [titleFontWeight]="700"
                  [titleColor]="'var(--ion-color-dark)'"
                  [showSubtitle]="false"
                  [showUnits]="false"
                  [outerStrokeWidth]="8"
                  [innerStrokeWidth]="4"
                  [outerStrokeColor]="'var(--ion-color-primary)'"
                  [innerStrokeColor]="'var(--ion-color-secondary)'"
                  [animation]="true"
                  [animationDuration]="500"
              ></circle-progress>
            </ion-card>
          </ion-col>
          <ion-col size="12">
            <ion-card mode="ios">
              <ion-card-header>
                <ion-card-subtitle>Percentuale recuperati</ion-card-subtitle>
                <ion-card-title>
                  {{ countryStatus?.stats?.recoveryRate.toFixed(2) }}<span class="percentage">%</span>
                </ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <ion-label>
                  <p class="ion-text-wrap"><span class="text-bold">{{ countryStatus?.confirmed | number }}</span> infetti</p>
                  <p class="ion-text-wrap"><span class="text-bold">{{ countryStatus?.recovered | number }}</span> recuperati</p>
                </ion-label>
              </ion-card-content>
              <circle-progress 
                [percent]="countryStatus?.stats?.recoveryRate" 
                [radius]="50"
                [title]="countryStatus?.stats?.recoveryRate.toFixed(2)"
                [titleFontSize]="14"
                [titleFontWeight]="700"
                [titleColor]="'var(--ion-color-dark)'"
                [showSubtitle]="false"
                [showUnits]="false"
                [outerStrokeWidth]="8"
                [innerStrokeWidth]="4"
                [outerStrokeColor]="'var(--ion-color-primary)'"
                [innerStrokeColor]="'var(--ion-color-secondary)'"
                [animation]="true"
                [animationDuration]="500"
            ></circle-progress>
            </ion-card>
          </ion-col>
          <ion-col size="12">
            <ion-card mode="ios">
              <ion-card-header>
                <ion-card-subtitle>Percentuale morti</ion-card-subtitle>
                <ion-card-title>
                  {{ countryStatus?.stats?.deathRate.toFixed(2) }}<span class="percentage">%</span>
                </ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <ion-label>
                  <p class="ion-text-wrap"><span class="text-bold">{{ countryStatus?.confirmed | number }}</span> infetti</p>
                  <p class="ion-text-wrap"><span class="text-bold">{{ countryStatus?.deaths | number }}</span> morti</p>
                </ion-label>
              </ion-card-content>
              <circle-progress 
                [percent]="countryStatus?.stats?.deathRate" 
                [radius]="50"
                [title]="countryStatus?.stats?.deathRate.toFixed(2)"
                [titleFontSize]="14"
                [titleFontWeight]="700"
                [titleColor]="'var(--ion-color-dark)'"
                [showSubtitle]="false"
                [showUnits]="false"
                [outerStrokeWidth]="8"
                [innerStrokeWidth]="4"
                [outerStrokeColor]="'var(--ion-color-primary)'"
                [innerStrokeColor]="'var(--ion-color-secondary)'"
                [animation]="true"
                [animationDuration]="500"
            ></circle-progress>
            </ion-card>
          </ion-col>
        </ion-row>
      </ion-col>

    </ion-row>

    <ion-row>
      <ion-col size="12">
        <ion-card mode="ios">
          <ion-card-header *ngIf="countryStatus">
            <ion-card-subtitle>
              Primo infetto: {{ countryStatus?.firstInfectedDate | date : 'dd/MM/yyyy' }}
            </ion-card-subtitle>
            <ion-card-title>Curva dei contagi</ion-card-title>
            <ion-card-subtitle>Ultimi 60 giorni</ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <canvas #lineChart></canvas>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
    
  </ion-grid>

</ion-content>
